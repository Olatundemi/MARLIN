<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
  {% endif %}
</head>
<body>
  {% include header.html %}
  
  <div class="page-container">
    <main class="main-content">
      {{ content }}
    </main>
    
    <aside class="sidebar">
      <div class="toc-container">
        <h3>On this page</h3>
        <nav class="toc" id="toc">
          <!-- Populated by JavaScript -->
        </nav>
      </div>
    </aside>
  </div>

  <footer>
    <p>&copy; 2024-{{ site.time | date: '%Y' }} {{ site.title }}. All rights reserved.</p>
  </footer>

  <script>
    // Generate table of contents from headers
    function generateTOC() {
      const toc = document.getElementById('toc');
      const mainContent = document.querySelector('.main-content');
      const headings = mainContent.querySelectorAll('h2, h3');
      
      if (headings.length === 0) {
        document.querySelector('.toc-container').style.display = 'none';
        return;
      }
      
      let lastLevel = 2;
      let html = '<ul>';
      
      headings.forEach((heading) => {
        const level = parseInt(heading.tagName[1]);
        const id = heading.id || heading.textContent.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
        heading.id = id;
        
        if (level > lastLevel) {
          html += '<ul>'.repeat(level - lastLevel);
        } else if (level < lastLevel) {
          html += '</ul>'.repeat(lastLevel - level);
        }
        
        html += `<li><a href="#${id}">${heading.textContent}</a></li>`;
        lastLevel = level;
      });
      
      html += '</ul>'.repeat(lastLevel - 2);
      toc.innerHTML = html;
    }
    
    document.addEventListener('DOMContentLoaded', generateTOC);
  </script>
</body>
</html>
